# include <semaphore.h>
# include <unistd.h> //sleep
# include <pthread.h>
# include <stdio.h>
#define taille 3
sem_t plein , vide , mutex ;
int tampon[ taille ] ;
pthread_t  cons,prod ;
void *consommateur () ;
void *producteur() ;
int main ( )
{
// initiliser les sèmaphores
sem_init(& plein , 0 , 0 ) ;
sem_init(&vide , 0 , taille ) ;
sem_init(&mutex , 0 , 1 ) ;
//crèer les threads
pthread_create (&cons,NULL,consommateur,NULL) ;
pthread_create (&prod,NULL,producteur,NULL) ;
// lancer les threads
pthread_join ( prod ,NULL) ;
pthread_join ( cons ,NULL) ;
printf( " fin des thread \n" ) ;
return 0 ;
}
void *consommateur ()
 {
int ic = 0 , nbcons = 0 , objet ;
do {
sem_wait(&plein) ;
sem_wait(&mutex) ;
// consommer
objet = tampon[ic] ;
sem_post(&mutex) ;
sem_post(&vide) ;
printf ( " icicons . : tampon[%d]= %d\n" , ic , objet ) ;
 ic =(ic+1)% taille ;
nbcons ++;
//sleep ( 2 ) ;
} while ( nbcons <=5 );
return (NULL) ;
}
void *producteur()
{
int ip = 0 , nbprod = 0 , objet =0; 
do {
sem_wait(&vide ) ;
sem_wait(&mutex ) ;
// produire
tampon[ ip ]= objet ;
sem_post(&mutex ) ;
sem_post(& plein ) ;
printf ( " ici prod . : tampon[%d]= %d\n" , ip , objet ) ;
objet ++;
nbprod++;
 ip =( ip+1)% taille ;
} while ( nbprod <=5 );
return NULL;
}
//Sortie du prog
