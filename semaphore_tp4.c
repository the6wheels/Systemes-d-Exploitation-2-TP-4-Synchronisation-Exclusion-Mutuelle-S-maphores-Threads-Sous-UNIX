#include<stdio.h>
#include<semaphore.h>
#include<pthread.h>

pthread_t consomat,product;
int ip=0;
int ic=0;
int tampon[10];


sem_t nvide,nplein,mutex;



void *producteur(){
	int i=0;
	int objet=100;
	while(i<20){
		objet++;
		sem_wait(&nvide);
		sem_wait(&mutex);
		tampon[ip]=objet;
		ip=(ip+1)%20;
		printf("PRODUCTEUR : tampon[%d] = %d \n",ip,objet);
		sem_post(&mutex);
		sem_post(&nplein);
		i++;
		}
	};


void *consomateur(){
	int i=0;
	int objet;
	while(i<20){
		
		sem_wait(&nplein);
		sem_wait(&mutex);
		objet=tampon[ic];
		ic=(ic+1)%20;
		printf("CONSOMATEUR : %d=tampon[%d]   \n",objet,ic);
		sem_post(&mutex);
		sem_post(&nvide);
		i++;
		}
	};

int main(){
	sem_init(&nvide,0,20);
	sem_init(&mutex,0,1);
	sem_init(&nplein,0,0);
	pthread_create(&product,NULL,producteur,NULL);
	pthread_create(&consomat,NULL,consomateur,NULL);


	pthread_join(product,NULL);
    pthread_join(consomat,NULL);
	
}
	
	
	

